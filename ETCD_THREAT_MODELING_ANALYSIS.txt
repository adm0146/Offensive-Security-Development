ETCD THREAT MODELING ANALYSIS - ASSIGNMENT SUBMISSION
======================================================

Date: February 2, 2026
Assignment: Threat Modeling for etcd using Claude and Gemini
Student: Andrew Mullins

---

PART 1: THREAT MODELING PROMPT
===============================

ETCD THREAT MODELING PROMPT

You are a security expert. Identify 5 distinct threat models for etcd (distributed key-value store used in Kubernetes).

For each threat, provide:
1. Threat Description
2. Threat Actor
3. Preconditions
4. Impact
5. Post-Conditions
6. Severity Rank (Critical/High/Medium/Low)

Use chain-of-thought reasoning. Format clearly with headers for each threat.

Context: etcd stores sensitive data (credentials, certificates, cluster state), uses HTTP/gRPC communication, has auth mechanisms.

Generate 5 realistic, technically feasible threats across different attack categories.


---

PART 2: CLAUDE RESPONSE - THREAT ANALYSIS
===========================================

etcd Threat Model Analysis
I'll systematically analyze etcd's attack surface, considering its role as Kubernetes' critical data store, its communication protocols, and authentication mechanisms.

Threat 1: Unauthenticated etcd API Access
-------------------------------------------
Chain of Thought Reasoning
etcd by default can run without authentication enabled. Many deployments, especially in development or misconfigured production environments, expose etcd's client port (2379) without requiring client certificates or credentials. An attacker who discovers this can directly query and modify all cluster secrets.

1. Threat Description
An attacker exploits an etcd cluster configured without authentication or with authentication disabled, gaining direct read/write access to the key-value store via the gRPC or HTTP API. This allows extraction of all Kubernetes secrets, service account tokens, and cluster configuration.

2. Threat Actor
- External attacker with network access (via misconfigured firewall/cloud security group)
- Malicious insider on the same network segment
- Compromised adjacent workload in the cluster

3. Preconditions
- etcd client port (2379) reachable from attacker's network position
- Authentication disabled (--client-cert-auth=false or no --auth-token configured)
- No network segmentation isolating etcd from untrusted networks

4. Impact
- Confidentiality: Complete exposure of all Kubernetes secrets (database passwords, API keys, TLS certificates, service account tokens)
- Integrity: Attacker can modify cluster state, inject malicious configurations, or delete critical data
- Availability: Cluster can be rendered inoperable by corrupting etcd data

5. Post-Conditions
- Attacker possesses all cluster credentials enabling lateral movement
- Persistent backdoor access possible via injected service accounts
- Full cluster compromise achievable through extracted admin credentials

6. Severity Rank: CRITICAL
Justification: Direct, unauthenticated access to the entire cluster's sensitive data store represents complete security boundary failure.

---

Threat 2: etcd Peer Communication Man-in-the-Middle Attack
-----------------------------------------------------------
Chain of Thought Reasoning
etcd nodes communicate over peer port 2380 for Raft consensus. If peer TLS is disabled or uses weak/self-signed certificates without proper verification, an attacker positioned on the network can intercept, modify, or inject messages between etcd members, potentially corrupting consensus or extracting replicated data.

1. Threat Description
An attacker with network positioning between etcd cluster members performs a man-in-the-middle attack on peer communication (port 2380). By intercepting Raft protocol messages, the attacker can observe replicated data, inject malicious entries, or disrupt consensus leading to split-brain scenarios.

2. Threat Actor
- Attacker who has compromised a network device (switch, router) in the etcd network path
- Cloud provider insider with infrastructure access
- Attacker who has achieved ARP spoofing position on a shared network segment

3. Preconditions
- Peer TLS disabled (--peer-client-cert-auth=false) or improperly configured
- Attacker has layer-2 or layer-3 positioning between etcd nodes
- Certificate validation disabled or certificates not pinned

4. Impact
- Confidentiality: All replicated data visible during transit between nodes
- Integrity: Potential for consensus manipulation or data injection
- Availability: Cluster stability compromised; forced leader elections or partition scenarios

5. Post-Conditions
- Attacker has observed all secrets replicated across the cluster
- Potential persistent compromise if malicious data successfully injected
- Cluster may enter degraded state requiring manual recovery

6. Severity Rank: HIGH
Justification: Requires privileged network position but enables silent data exfiltration and potential integrity compromise of the entire cluster state.

---

Threat 3: Snapshot/Backup Data Exfiltration
---------------------------------------------
Chain of Thought Reasoning
etcd snapshots contain the complete database state and are used for backup/restore operations. These snapshots are often stored on disk, in object storage (S3, GCS), or transferred over networks. If not encrypted at rest and in transit, they represent a high-value target containing all cluster secrets in a portable format.

1. Threat Description
An attacker gains access to etcd snapshot files through compromised backup storage, insecure backup transfer mechanisms, or local filesystem access on etcd nodes. The snapshot provides a complete copy of all Kubernetes secrets and cluster configuration that can be extracted offline.

2. Threat Actor
- Attacker who has compromised the backup storage system (S3 bucket, NFS share)
- Insider with access to backup infrastructure
- Attacker with read access to etcd node filesystem (container escape, SSH compromise)

3. Preconditions
- etcd snapshots stored without encryption at rest
- Backup storage permissions overly permissive
- Snapshot transfer occurs over unencrypted channels
- No audit logging on snapshot access

4. Impact
- Confidentiality: Complete extraction of all historical secrets (including rotated credentials if snapshots retained)
- Integrity: N/A (read-only access to backup)
- Availability: N/A directly, but extracted credentials enable further attacks

5. Post-Conditions
- Attacker possesses offline copy of cluster secrets for credential extraction
- Attack may go undetected if no backup access auditing
- Historical secrets potentially compromised even if current credentials rotated

6. Severity Rank: HIGH
Justification: Portable, complete database copy containing all sensitive data; often stored with weaker protections than the live cluster.

---

Threat 4: Resource Exhaustion Denial of Service via Watch/Range Abuse
----------------------------------------------------------------------
Chain of Thought Reasoning
etcd's API supports watch operations (streaming changes) and range queries (bulk reads). An authenticated or unauthenticated attacker (depending on configuration) can abuse these endpoints to exhaust etcd's memory, CPU, or file descriptors, causing service degradation or complete cluster failure.

1. Threat Description
An attacker with API access (authenticated or not) launches a denial-of-service attack by creating thousands of concurrent watch connections, executing expensive range queries across large key spaces, or rapidly creating/deleting keys to generate excessive write-ahead log entries and compaction load.

2. Threat Actor
- Compromised pod with etcd network access (even read-only service account)
- External attacker against exposed etcd endpoint
- Malicious or buggy controller creating excessive watches

3. Preconditions
- Attacker has network connectivity to etcd client port
- No rate limiting configured on etcd API
- Insufficient resource quotas or connection limits
- RBAC (if enabled) permits broad read access or watch creation

4. Impact
- Confidentiality: N/A
- Integrity: N/A directly, though recovery operations may introduce errors
- Availability: Complete Kubernetes control plane outage; scheduler, controller-manager, and API server unable to function

5. Post-Conditions
- Cluster enters degraded state; workloads continue but no new scheduling/updates possible
- Manual intervention required to restore etcd cluster
- Potential data loss if write-ahead log corruption occurs during resource exhaustion

6. Severity Rank: HIGH
Justification: Control plane availability critical for cluster operations; attack feasible from relatively low-privilege starting position.

---

Threat 5: Client Certificate Private Key Compromise
----------------------------------------------------
Chain of Thought Reasoning
etcd authentication relies heavily on mTLS with client certificates. The private keys for these certificates (especially the root CA or admin-level client certs) are stored on control plane nodes, in secrets management systems, or in deployment automation. Compromise of these keys grants persistent, legitimate-appearing access.

1. Threat Description
An attacker obtains etcd client certificate private keys through filesystem access on control plane nodes, compromise of certificate management systems (Vault, cert-manager), or extraction from improperly secured Infrastructure-as-Code repositories. These credentials provide authenticated access indistinguishable from legitimate cluster operations.

2. Threat Actor
- Attacker with control plane node access (container escape, SSH compromise)
- Developer/operator with access to secrets management or IaC repositories
- Supply chain attacker who has compromised certificate generation tooling

3. Preconditions
- Client certificate private keys stored without hardware security module (HSM) protection
- Keys present in version control, configuration management, or automation systems
- Insufficient access controls on certificate storage locations
- No certificate rotation or short validity periods

4. Impact
- Confidentiality: Full read access to all etcd data using legitimate credentials
- Integrity: Ability to modify any cluster state with valid authentication
- Availability: Can delete or corrupt data while appearing as authorized client

5. Post-Conditions
- Persistent access until certificates rotated/revoked
- Difficult to distinguish malicious access from legitimate operations in audit logs
- Attacker can create additional credentials for redundant access

6. Severity Rank: CRITICAL
Justification: Credential compromise bypasses all authentication controls; provides persistent access that survives typical incident response actions unless certificates explicitly revoked.

---

Summary Matrix
---------------

| Threat | Category | Severity | Primary Control Gap |
|--------|----------|----------|-------------------|
| Unauthenticated API Access | Authentication Bypass | Critical | Missing authn configuration |
| Peer MITM | Transport Security | High | Peer TLS disabled/misconfigured |
| Snapshot Exfiltration | Data Protection | High | Backup encryption gaps |
| Resource Exhaustion DoS | Availability | High | Missing rate limiting |
| Certificate Key Compromise | Credential Management | Critical | Key storage/rotation |

Recommended Mitigations Summary
- Always enable client certificate authentication (--client-cert-auth=true)
- Enable and verify peer TLS (--peer-client-cert-auth=true with proper CA validation)
- Encrypt snapshots at rest and restrict backup storage access with auditing
- Implement connection limits and rate limiting via proxy or etcd configuration
- Store private keys in HSMs or secrets managers with short-lived certificates and automated rotation

---

NEXT STEP: Gemini Analysis
===========================

etcd Threat Models - STRIDE-Based Analysis
Gemini Response

As the "brain" of a Kubernetes cluster, etcd is the ultimate prize for an attacker. If you control etcd, you control the entire cluster state, including secrets, configurations, and the ability to schedule malicious workloads. Here are 5 distinct threat models based on the STRIDE methodology (Spoofing, Tampering, Repudiation, Information Disclosure, Denial of Service, and Elevation of Privilege).

---

Threat 1: Unauthorized Access via Unauthenticated Peer Communication
--------------------------------------------------------------------
Category: Spoofing / Information Disclosure

Threat Description: By default, etcd nodes communicate via a peer URL (usually port 2380). If Mutual TLS (mTLS) is not strictly enforced for peer-to-peer communication, an attacker can "join" a rogue node to the cluster.

Threat Actor: Internal Malicious Actor or External Attacker with Network Access.

Preconditions: 
- etcd is configured without --peer-client-cert-auth=true
- The peer network is reachable from a compromised pod/node

Impact: The attacker's node synchronizes the entire keyspace, granting them a full copy of all cluster data, including secrets and service account tokens.

Post-Conditions: The attacker maintains a persistent, live-updating mirror of the cluster state.

Severity Rank: CRITICAL

---

Threat 2: Sensitive Data Leakage via Unencrypted Client Traffic
---------------------------------------------------------------
Category: Information Disclosure

Threat Description: If the client-to-server communication (port 2379) is not encrypted via TLS, sensitive data sent by the Kubernetes API server (like Secret objects) travels in plaintext across the network.

Threat Actor: Network Eavesdropper (Man-in-the-Middle).

Preconditions: 
- client-cert-auth is disabled or TLS is not enforced on the client listener
- The attacker has sniffing capabilities on the management network

Impact: Exposure of bootstrap tokens, database credentials, and TLS private keys stored as Kubernetes Secrets.

Post-Conditions: Attacker possesses credentials to escalate privileges within the Kubernetes cluster or connected cloud infrastructure.

Severity Rank: HIGH

---

Threat 3: Storage Level Data Exfiltration (Cold Boot/Disk Access)
------------------------------------------------------------------
Category: Information Disclosure / Tampering

Threat Description: etcd stores data in a write-ahead log (WAL) and snapshot files on the host file system. If the underlying disk or the host OS is compromised, an attacker can bypass etcd's gRPC interface entirely.

Threat Actor: Malicious Cloud Provider Admin or Host-level Attacker.

Preconditions: 
- The disk volume where etcd data resides is not encrypted at rest
- The attacker gains root access to the host or manages to snapshot the volume

Impact: The attacker can use tools like etcdutl to dump the entire database offline, bypassing all etcd-level RBAC and authentication.

Post-Conditions: Complete compromise of cluster secrets without triggering any etcd audit logs.

Severity Rank: HIGH

---

Threat 4: Resource Exhaustion via Malformed/Massive Queries
------------------------------------------------------------
Category: Denial of Service (DoS)

Threat Description: An attacker with authenticated access (or unauthenticated, if poorly configured) submits a large volume of "expensive" range requests or high-frequency writes that exceed the quota-backend-bytes limit.

Threat Actor: Authenticated Malicious User or Compromised Service Account.

Preconditions: 
- Lack of rate limiting at the API server level or direct access to the etcd client port
- Small default storage quotas

Impact: etcd hits a "database space exceeded" alarm, putting the cluster into a read-only state. Since the API server cannot write, the entire Kubernetes control plane effectively halts.

Post-Conditions: Cluster-wide downtime; requires manual intervention (defragmentation and alarm clearing) to restore service.

Severity Rank: MEDIUM

---

Threat 5: Privilege Escalation via RBAC Misconfiguration
---------------------------------------------------------
Category: Elevation of Privilege

Threat Description: etcd has its own internal RBAC system independent of Kubernetes. If a user or service is granted a role with write access to the /registry/ prefix, they can modify the cluster state directly.

Threat Actor: Insider with limited etcd access.

Preconditions: 
- etcd auth is enabled, but the user is assigned a role with overly broad prefix permissions
- Permission to write to /registry/secrets/ or similar critical paths

Impact: The attacker can modify a ClusterRoleBinding directly in etcd to grant themselves cluster-admin rights in Kubernetes, bypassing Kubernetes API validation logic.

Post-Conditions: The attacker achieves full administrative control over the Kubernetes cluster.

Severity Rank: HIGH

---

GEMINI SUMMARY TABLE
====================

| Threat | Threat Actor | Primary Impact | Severity |
|--------|-------------|----------------|----------|
| Rogue Peer Join | Network Attacker | Full Data Mirroring | Critical |
| Plaintext Sniffing | MitM / Eavesdropper | Secret Leakage | High |
| Disk Snapshotting | Host/Cloud Admin | Offline Data Dump | High |
| Storage DoS | Authenticated User | Cluster Downtime | Medium |
| RBAC Bypass | Insider / User | Privilege Escalation | High |

---

COMPARATIVE ANALYSIS: CLAUDE VS GEMINI
=======================================

Similarities:
- Both identified critical authentication/authorization gaps
- Both highlighted data confidentiality risks
- Both recognized denial-of-service attack vectors
- Both provided severity rankings (Critical, High, Medium)

Differences:
- Claude focused on transport-layer security and credential management
- Gemini emphasized physical/storage-layer attacks and RBAC misconfiguration
- Claude's Threat 5 (Certificate Key Compromise) addresses credential lifecycle
- Gemini's Threat 5 (RBAC Misconfiguration) addresses authorization logic
- Gemini explicitly used STRIDE methodology; Claude used more descriptive approach

Overlapping Threats:
- Unauthenticated API Access (Claude #1 vs Gemini #1): Both Critical
- Peer Communication Security (Claude #2 vs Gemini #1): Both recognize critical peer risks
- Data Exfiltration (Claude #3 vs Gemini #3): Both High severity
- Resource Exhaustion DoS (Claude #4 vs Gemini #4): Claude=High, Gemini=Medium

Unique Insights:
- Claude: Certificate private key compromise as persistent threat vector
- Gemini: Cold boot/disk-level attacks bypassing all application-level security
- Claude: Connection-level rate limiting recommendations
- Gemini: etcd-native RBAC independent from Kubernetes RBAC

---

CONSOLIDATED THREAT RANKING (ALL THREATS)
==========================================

Rank 1: CRITICAL
- Unauthenticated etcd API Access (Claude)
- Client Certificate Private Key Compromise (Claude)
- Rogue Peer Join via Unauthenticated Peer Communication (Gemini)

Rank 2: HIGH
- etcd Peer Communication MITM Attack (Claude)
- Snapshot/Backup Data Exfiltration (Claude)
- Resource Exhaustion DoS (Claude - classified HIGH)
- Plaintext Client Traffic Leakage (Gemini)
- Storage Level Data Exfiltration/Disk Access (Gemini)
- RBAC Misconfiguration Privilege Escalation (Gemini)

Rank 3: MEDIUM
- Resource Exhaustion DoS via Watch/Range Abuse (Claude - classified HIGH)
- Resource Exhaustion DoS (Gemini - classified MEDIUM)

---

KEY FINDINGS SUMMARY
====================

Total Threats Identified: 8 unique threats (some overlapping)
Critical Severity Threats: 3
High Severity Threats: 6
Medium Severity Threats: 1

Primary Control Gaps Identified:
1. Authentication: Unauthenticated access to client and peer ports
2. Encryption: Plaintext communication and unencrypted data at rest
3. Credential Management: Private key storage and rotation
4. Access Control: RBAC misconfiguration and overly broad permissions
5. Resource Management: Missing rate limiting and quota enforcement
6. Physical Security: Disk-level data protection

Recommended Mitigations (Combined from Both Analyses):

Authentication:
- Enable --client-cert-auth=true (required client certificates)
- Enable --peer-client-cert-auth=true (required peer certificates)
- Implement etcd role-based access control (RBAC)
- Use strong, rotated credentials

Encryption:
- Enforce TLS for all client connections (port 2379)
- Enforce mutual TLS (mTLS) for peer communication (port 2380)
- Enable encryption at rest (--encryption-provider flag in Kubernetes)
- Encrypt etcd snapshots and backup files

Credential Management:
- Store private keys in HSM or secrets manager (not on disk)
- Implement certificate rotation with short validity periods
- Audit all certificate access and rotations
- Use automated certificate management tools

Access Control:
- Implement least privilege RBAC within etcd
- Restrict service account permissions
- Audit all RBAC modifications
- Separate etcd RBAC from Kubernetes RBAC where possible

Resource Management:
- Implement rate limiting at API server and etcd proxy level
- Set appropriate storage quotas and alarms
- Monitor resource consumption
- Set connection limits

Physical/Storage Security:
- Encrypt etcd volumes at rest (full-disk encryption)
- Restrict physical/hypervisor access to etcd nodes
- Use hardware security modules (HSM) for key storage
- Implement secure boot and attestation

Network Security:
- Isolate etcd network from untrusted networks
- Use network policies and firewalls
- Disable unnecessary network exposure
- Monitor network access and anomalies

